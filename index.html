<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>HandSpeak â€” AI-Powered Sign Language Revolution</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Color variables based on login.css theme */
        :root {
            --primary: #00c3ff;
            --secondary: #00fff2;
            --accent: #ffffff;
            --success: #10B981;
            --warning: #0f0bf5;
            --bg-dark: #000000;
            --bg-card: rgba(26, 26, 26, 0.65);
            --bg-glass: rgba(0, 0, 0, 0.9);
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --border: #00f7ffb7;
            --gradient-primary: linear-gradient(to right, rgb(0, 255, 191), rgb(0, 247, 255));
            --gradient-secondary: linear-gradient(to right, rgb(255, 0, 0), rgb(255, 166, 0));
            --shadow-lg: 0 0 10px rgba(0, 255, 255, 0.5);
            --shadow-glow: 0 0 20px rgba(0, 255, 255, 0.7);
        }

        /* General Body and Main Containers */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Animated Background */
        #techCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            display: none;
            z-index: 1;
            animation: slideInUp 0.8s ease-out;
        }

        .container.active {
            display: block;
        }

        /* Glass Card Effect */
        .glass-card {
            background: var(--bg-card);
            backdrop-filter: blur(6px);
            border: 3px solid var(--border);
            border-radius: 1rem;
            padding: 3rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        /* Typography */
        .hero-title, .section-title {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 800;
            color: var(--secondary);
            text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
            text-align: center;
            margin-bottom: 1rem;
            line-height: 1.1;
        }

        .subtitle {
            font-size: 1.5rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 3rem;
            font-weight: 300;
        }
        
        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 1.5rem;
            text-align: center;
            text-shadow: none;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            border: none;
            border-radius: 1rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            color: black;
        }

        .btn-primary {
            background: var(--gradient-primary);
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: black;
        }

        .btn-secondary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }
        
        /* Home Page specific styles */
        .home-page-buttons {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 3rem;
            align-items: center;
        }
        
        .home-page-buttons .btn {
            width: 100%;
            max-width: 400px;
            justify-content: center;
        }
        
        .home-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .home-header h2 {
            margin: 0;
            color: var(--primary);
        }
        
        .user-greeting {
            font-size: 1.25rem;
            font-weight: 500;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 1rem 1.5rem;
            background: #111;
            border: 1px solid #00c3ff;
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            outline: none;
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: #777;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(0, 195, 255, 0.2);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }

        /* Info Sections */
        .info-section {
            background: var(--bg-card);
            backdrop-filter: blur(6px);
            border: 3px solid var(--border);
            border-radius: 1rem;
            padding: 2.5rem;
            margin: 2rem 0;
        }

        .info-section h3 {
            color: var(--secondary);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
        }

        /* Team Cards */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .team-card {
            background: #1a1a1a;
            border: 3px solid var(--border);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.4s ease;
        }

        .team-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-glow);
        }

        .team-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 0.5rem;
        }

        .team-role {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Detection Page Styles */
        .detection-container {
            text-align: center;
        }

        .camera-stage {
            position: relative;
            margin: 2rem auto;
            width: 100%;
            max-width: 640px;
            aspect-ratio: 4 / 3;
            border-radius: 1rem;
            overflow: hidden;
            background: #222;
            border: 3px solid #00fff2;
            box-shadow: var(--shadow-lg);
        }

        #webcam, #overlay {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            transform: scaleX(-1);
        }
        
        #overlay {
            z-index: 10;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .output {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00c3ff;
            border-radius: 1rem;
            backdrop-filter: blur(10px);
            font-size: 1.2rem;
            color: #00fff2;
            font-weight: 600;
        }

        /* Switch Links */
        .auth-switch {
            text-align: center;
            margin-top: 2rem;
            color: var(--text-secondary);
        }

        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .auth-switch a:hover {
            color: var(--secondary);
        }

        /* Checkbox Styling */
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .checkbox-container input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            margin: 10% auto;
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            animation: slideInUp 0.5s ease-out;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #00f7ffb7;
            box-shadow: 0 0 8px 8px cyan;
        }

        .close-btn {
            color: #ffffff;
            float: right;
            font-size: 3rem;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover {
            color: cyan;
        }

        #gestureList {
            list-style-type: none;
            padding: 0;
            margin-top: 1rem;
        }

        #gestureList li {
            background: #1a1a1a;
            border-left: 3px solid var(--primary);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            transition: background 0.3s ease;
        }
        
        #gestureList li:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        #gestureList li strong {
            color: var(--primary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .glass-card { padding: 2rem 1.5rem; }
            .hero-title { font-size: 2.5rem; }
            .subtitle { font-size: 1.2rem; }
            .camera-stage { width: 100%; max-width: 480px; aspect-ratio: 4 / 3; }
            .controls { flex-direction: column; }
        }
        
        /* Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse { animation: pulse 2s infinite; }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: #00fff2;
            color: black;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            z-index: 1000;
            font-weight: 600;
            animation: slideInRight 0.3s ease-out;
            max-width: 300px;
            word-wrap: break-word;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
    </style>
</head>
<body>
    <canvas id="techCanvas"></canvas>
    <div class="overlay"></div>

    <div class="container active" id="welcomePage">
        <div class="glass-card">
            <h1 class="hero-title">HandSpeak</h1>
            <p class="subtitle">Revolutionizing Communication Through AI-Powered Sign Language</p>
            
            <div class="info-section">
                <h3><i class="fas fa-magic"></i> About HandSpeak</h3>
                <p>HandSpeak is an innovative web application that bridges the communication gap between the deaf, hard of hearing, and those unfamiliar with sign language. Harnessing cutting-edge gesture recognition technology, HandSpeak translates sign language into real-time text and converts it into natural, lifelike speech, making interactions effortless and seamless.</p>
                <br>
                <p>Our mission is to empower communication for all, breaking barriers and creating a world where every gesture speaks, every conversation matters, and no voice goes unheard. With HandSpeak, technology meets empathy, ensuring accessibility is not just a feature, but an experience.</p>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-users"></i> Meet Our Team</h3>
                <div class="team-grid">
                    <div class="team-card">
                        <div class="team-name">Vishwak Yellamalli</div>
                        <div class="team-role">Frontend & UI/UX Developer</div>
                    </div>
                    <div class="team-card">
                        <div class="team-name">Kush Vora</div>
                        <div class="team-role">Backend Developer & Database Management</div>
                    </div>
                    <div class="team-card">
                        <div class="team-name">Sairaj Walawalkar</div>
                        <div class="team-role">Backend Developer & Database Management</div>
                    </div>
                    <div class="team-card">
                        <div class="team-name">Kartik Yadav</div>
                        <div class="team-role">Backend Developer & Database Management</div>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-map-marker-alt"></i> Contact & Location</h3>
                <p><strong>Office:</strong> HandSpeak HQ, Mumbai, India</p>
                <p><strong>Contact:</strong> +91 8591579369</p>
                <p><strong>Email:</strong> hello@handspeak.ai</p>
            </div>

            <div style="text-align: center; margin-top: 3rem;">
                <button class="btn btn-primary pulse" onclick="showPage('loginPage')">
                    <i class="fas fa-rocket"></i>
                    Get Started
                </button>
            </div>
        </div>
    </div>

    <div class="container" id="loginPage">
        <div class="glass-card" style="max-width: 500px; margin: 0 auto;">
            <h2 class="section-title">Welcome Back</h2>
            <p class="subtitle" style="font-size: 1rem; margin-bottom: 2rem;">Sign in to your account</p>
            
            <form onsubmit="loginUser(event); return false;">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="loginEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                    <i class="fas fa-sign-in-alt"></i>
                    Sign In
                </button>
            </form>
            
            <div class="auth-switch">
                Don't have an account? 
                <a onclick="showPage('registerPage')">Create one now</a>
            </div>
        </div>
    </div>

    <div class="container" id="registerPage">
        <div class="glass-card" style="max-width: 500px; margin: 0 auto;">
            <h2 class="section-title">Join HandSpeak</h2>
            <p class="subtitle" style="font-size: 1rem; margin-bottom: 2rem;">Create your account</p>
            
            <form onsubmit="registerUser(event); return false;">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="fullName" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="regEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label class="form-label">Age</label>
                    <input type="number" class="form-input" id="age" required min="1" placeholder="Enter your age">
                </div>
                <div class="form-group">
                    <label class="form-label">Gender</label>
                    <select class="form-input" id="gender" required>
                        <option value="">Select Gender</option>
                        <option>Male</option>
                        <option>Female</option>
                        <option>Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="regPassword" required placeholder="Create a password">
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="confirmPassword" required placeholder="Confirm your password">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                    <i class="fas fa-user-plus"></i>
                    Create Account
                </button>
            </form>
            
            <div class="auth-switch">
                Already have an account? 
                <a onclick="showPage('loginPage')">Sign in here</a>
            </div>
        </div>
    </div>

    <div class="container" id="homePage">
        <div class="glass-card" style="max-width: 700px; margin: 0 auto; text-align: center;">
            <div class="home-header">
                <h2 class="user-greeting">Welcome, <span id="userNameDisplay">User</span>!</h2>
                <button class="btn btn-secondary" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
            <h1 class="hero-title" style="margin-top: 0;">HandSpeak</h1>
            <p class="subtitle" style="margin-bottom: 3rem;">Choose an option to get started</p>
            
            <div class="home-page-buttons">
                <button class="btn btn-primary" onclick="showPage('detectionPage')">
                    <i class="fas fa-hand-paper"></i>
                    Gesture Detection
                </button>
                <button class="btn btn-primary" onclick="showPage('textToSpeechPage')">
                    <i class="fas fa-volume-up"></i>
                    Text to Speech
                </button>
                <button class="btn btn-primary" onclick="showPage('feedbackPage')">
                    <i class="fas fa-comment"></i>
                    Feedback
                </button>
            </div>
        </div>
    </div>

    <div class="container" id="detectionPage">
        <div class="glass-card detection-container">
            <h1 class="section-title">
                <i class="fas fa-hand-paper"></i>
                Live Sign Detection
            </h1>
            <p class="subtitle" style="margin-bottom: 2rem;">Real-time sign language recognition and speech conversion</p>
            
            <div class="camera-stage">
                <video id="webcam" autoplay playsinline></video>
                <canvas id="overlay" width="640" height="480"></canvas>
            </div>
            
            <div class="controls">
                <button id="startBtn" class="btn btn-primary">
                    <i class="fas fa-play"></i>
                    Start Detection
                </button>
                <button id="stopBtn" class="btn btn-secondary" disabled>
                    <i class="fas fa-stop"></i>
                    Stop
                </button>
                <button id="speakBtn" class="btn btn-primary">
                    <i class="fas fa-volume-up"></i>
                    Speak Now
                </button>
                <div class="checkbox-container">
                    <input type="checkbox" id="autoSpeak" checked>
                    <label>Auto-speak detected text</label>
                </div>
                <button id="infoBtn" class="btn btn-primary">
                    <i class="fas fa-info-circle"></i>
                </button>
            </div>
            
            <div class="output" id="detectedText">
                <i class="fas fa-eye"></i>
                Detected Text: <strong>None</strong>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-secondary" onclick="showPage('homePage')">
                    <i class="fas fa-arrow-left"></i>
                    Back to Home
                </button>
            </div>
        </div>
    </div>

    <div class="container" id="feedbackPage">
        <div class="glass-card" style="max-width: 700px; margin: 0 auto;">
            <h2 class="section-title">
                <i class="fas fa-comment-dots"></i>
                Feedback & Queries
            </h2>
            <p class="subtitle" style="font-size: 1rem; margin-bottom: 2rem;">We'd love to hear from you!</p>

            <form onsubmit="submitFeedback(event); return false;">
                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input type="text" class="form-input" id="feedbackName" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="feedbackEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label class="form-label">Your Message</label>
                    <textarea class="form-textarea" id="feedbackMessage" required placeholder="Type your feedback or query here..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; margin-bottom: 1rem;">
                    <i class="fas fa-paper-plane"></i>
                    Submit
                </button>
            </form>
            
            <div style="text-align: center; margin-top: 1rem;">
                <button class="btn btn-secondary" onclick="showPage('homePage')">
                    <i class="fas fa-arrow-left"></i>
                    Back to Home
                </button>
            </div>
        </div>
    </div>

    <div class="container" id="textToSpeechPage">
        <div class="glass-card" style="max-width: 700px; margin: 0 auto;">
            <h2 class="section-title">
                <i class="fas fa-volume-up"></i>
                Text to Speech
            </h2>
            <p class="subtitle">Type text to hear it spoken aloud.</p>

            <div class="form-group">
                <label for="textInput" class="form-label">Enter Text</label>
                <textarea class="form-textarea" id="textInput" placeholder="Type your message here..."></textarea>
            </div>

            <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin-top: 1rem;">
                <button class="btn btn-primary" id="speakTextBtn">
                    <i class="fas fa-volume-up"></i>
                    Speak Text
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-secondary" onclick="showPage('homePage')">
                    <i class="fas fa-arrow-left"></i>
                    Back to Home
                </button>
            </div>
        </div>
    </div>

    <div id="detectionInfoModal" class="modal">
        <div class="modal-content glass-card">
            <span class="close-btn">&times;</span>
            <h3 class="section-title">Detected Signs & Their Gestures</h3>
            <ul id="gestureList"></ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    
    <script>
        // In-memory user storage
        let registeredUsers = {};
        let loggedInUser = null;

        // Canvas animation from the login page
        const canvas = document.getElementById("techCanvas");
        const ctx = canvas.getContext("2d");

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        let nodes = [];
        const numNodes = 80;

        for (let i = 0; i < numNodes; i++) {
            nodes.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 1,
                vy: (Math.random() - 0.5) * 1
            });
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < numNodes; i++) {
                for (let j = i + 1; j < numNodes; j++) {
                    let dx = nodes[i].x - nodes[j].x;
                    let dy = nodes[i].y - nodes[j].y;
                    let dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 150) {
                        ctx.strokeStyle = `rgba(0, 195, 255, ${1 - dist / 150})`;
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.moveTo(nodes[i].x, nodes[i].y);
                        ctx.lineTo(nodes[j].x, nodes[j].y);
                        ctx.stroke();
                    }
                }
            }
            for (let i = 0; i < numNodes; i++) {
                ctx.beginPath();
                ctx.arc(nodes[i].x, nodes[i].y, 3, 0, Math.PI * 2);
                ctx.fillStyle = "#00c3ff";
                ctx.fill();
                nodes[i].x += nodes[i].vx;
                nodes[i].y += nodes[i].vy;
                if (nodes[i].x < 0 || nodes[i].x > canvas.width) nodes[i].vx *= -1;
                if (nodes[i].y < 0 || nodes[i].y > canvas.height) nodes[i].vy *= -1;
            }
            requestAnimationFrame(animate);
        }
        animate();

        function showPage(pageId) {
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                window.scrollTo({
                    top: 0, 
                    behavior: 'smooth'
                });
                console.log(`Mapped to: ${pageId}`);
            }
            
            if (pageId !== 'detectionPage') {
                stopCameraAndDetection();
            }
            
            if (pageId === 'homePage' && loggedInUser) {
                const userNameDisplay = document.getElementById('userNameDisplay');
                if (userNameDisplay) {
                    userNameDisplay.textContent = loggedInUser.name;
                }
            }
        }

        function registerUser(event) {
            event.preventDefault();
            
            const name = document.getElementById("fullName").value;
            const email = document.getElementById("regEmail").value;
            const pass = document.getElementById("regPassword").value;
            const confirm = document.getElementById("confirmPassword").value;

            if (pass !== confirm) {
                showNotification("Passwords do not match!", 'error');
                return false;
            }

            registeredUsers[email] = { name, password: pass };
            
            showNotification("Registration successful!", 'success');
            
            document.getElementById("fullName").value = "";
            document.getElementById("regEmail").value = "";
            document.getElementById("age").value = "";
            document.getElementById("gender").value = "";
            document.getElementById("regPassword").value = "";
            document.getElementById("confirmPassword").value = "";
            
            setTimeout(() => {
                showPage('loginPage');
            }, 1500);
            
            return false;
        }

        function loginUser(event) {
            event.preventDefault();
            
            const email = document.getElementById("loginEmail").value;
            const pass = document.getElementById("loginPassword").value;

            if (registeredUsers[email] && registeredUsers[email].password === pass) {
                loggedInUser = registeredUsers[email];
                showNotification(`Welcome back, ${loggedInUser.name}!`, 'success');
                
                document.getElementById("loginEmail").value = "";
                document.getElementById("loginPassword").value = "";
                
                setTimeout(() => {
                    showPage('homePage');
                }, 1500);
            } else {
                showNotification("Invalid email or password!", 'error');
            }
            return false;
        }

        function submitFeedback(event) {
            event.preventDefault();
            
            const name = document.getElementById("feedbackName").value;
            const email = document.getElementById("feedbackEmail").value;
            const message = document.getElementById("feedbackMessage").value;

            console.log("Feedback Submitted:", { name, email, message });

            showNotification("Thank you for your feedback!", 'success');
            
            document.getElementById("feedbackName").value = "";
            document.getElementById("feedbackEmail").value = "";
            document.getElementById("feedbackMessage").value = "";
            
            setTimeout(() => {
                showPage('homePage');
            }, 2000);

            return false;
        }

        function logout() {
            stopCameraAndDetection();
            loggedInUser = null;
            showNotification("You have been logged out successfully.", 'info');
            showPage('loginPage');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.classList.add('notification');
            notification.style.background = type === 'success' ? '#00fff2' : type === 'info' ? '#00c3ff' : '#ff3d71';
            notification.style.color = type === 'success' || type === 'info' ? 'black' : 'white';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }
        
        // MediaPipe and Detection Logic
        const videoElem = document.getElementById('webcam');
        const canvasElem = document.getElementById('overlay');
        const canvasCtx = canvasElem ? canvasElem.getContext('2d') : null;
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const speakBtn = document.getElementById('speakBtn');
        const autoSpeakCheckbox = document.getElementById('autoSpeak');
        const detectedTextEl = document.getElementById('detectedText');

        let camera = null, hands = null, running = false;
        let lastPred = null, predCount = 0, REQUIRED_CONSISTENCY = 8, currentLabel = "None";

        function isFingerUp(landmarks, finger) {
            const fingerMap = {
                thumb: [1, 2, 3, 4],
                index: [5, 6, 7, 8],
                middle: [9, 10, 11, 12],
                ring: [13, 14, 15, 16],
                pinky: [17, 18, 19, 20]
            };
            
            const ids = fingerMap[finger];
            if (!ids) return false;
            
            const tip = landmarks[ids[ids.length - 1]];
            const pip = landmarks[ids[1]];
            
            if (finger === 'thumb') {
                return tip.y < pip.y; 
            } else {
                return tip.y < pip.y;
            }
        }
        
        function recognizeFromLandmarks(landmarks) {
            if (!landmarks) return null;

            const thumbUp = landmarks[4].y < landmarks[3].y;
            const indexUp = landmarks[8].y < landmarks[7].y;
            const middleUp = landmarks[12].y < landmarks[11].y;
            const ringUp = landmarks[16].y < landmarks[15].y;
            const pinkyUp = landmarks[20].y < landmarks[19].y;

            if (thumbUp && indexUp && middleUp && ringUp && pinkyUp) {
                return "Thank you";
            }
            if (thumbUp && indexUp && !middleUp && !ringUp && pinkyUp) {
                return "I love you";
            }
            if (!thumbUp && indexUp && middleUp && ringUp && pinkyUp) {
                return "Hello";
            }
            if (!thumbUp && !indexUp && !middleUp && !ringUp && pinkyUp) {
                return "Goodbye";
            }
            if (thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Yes";
            }
            if (!thumbUp && indexUp && middleUp && !ringUp && !pinkyUp) {
                return "No";
            }
            if (thumbUp && !indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Help needed";
            }
            if (!thumbUp && indexUp && !middleUp && ringUp && !pinkyUp) {
                return "Food please";
            }
            if (thumbUp && !indexUp && !middleUp && ringUp && !pinkyUp) {
                return "Water please";
            }
            if (!thumbUp && indexUp && middleUp && !ringUp && pinkyUp) {
                return "Emergency";
            }
            if (thumbUp && indexUp && !middleUp && ringUp && !pinkyUp) {
                return "Medicine";
            }
            if (!thumbUp && !indexUp && middleUp && ringUp && pinkyUp) {
                return "Hospital";
            }
            if (thumbUp && !indexUp && middleUp && ringUp && !pinkyUp) {
                return "Phone";
            }
            if (!thumbUp && indexUp && !middleUp && !ringUp && pinkyUp) {
                return "Restroom";
            }
            // Add these new gesture checks
            if (thumbUp && !indexUp && middleUp && ringUp && pinkyUp) {
                return "Please wait";
            }
            if (!thumbUp && indexUp && middleUp && ringUp && !pinkyUp) {
                return "Need water";
            }
            if (thumbUp && indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Feel sick";
            }
            if (!thumbUp && !indexUp && middleUp && !ringUp && pinkyUp) {
                return "Need rest";
            }
            if (thumbUp && !indexUp && !middleUp && ringUp && pinkyUp) {
                return "Call doctor";
            }
            if (!thumbUp && indexUp && !middleUp && ringUp && pinkyUp) {
                return "Feel pain";
            }
            if (thumbUp && !indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Need medicine";
            }
            if (!thumbUp && indexUp && middleUp && !ringUp && pinkyUp) {
                return "Call ambulance";
            }
            if (thumbUp && !indexUp && middleUp && !ringUp && pinkyUp) {
                return "Feel dizzy";
            }
            if (!thumbUp && indexUp && !middleUp && ringUp && !pinkyUp) {
                return "Need help";
            }
            // Add these new gesture combinations
            if (thumbUp && indexUp && middleUp && !ringUp && pinkyUp) {
                return "Feeling cold";
            }
            if (!thumbUp && indexUp && middleUp && ringUp && !pinkyUp) {
                return "Feeling hot";
            }
            if (thumbUp && !indexUp && middleUp && !ringUp && pinkyUp) {
                return "Need blanket";
            }
            if (!thumbUp && indexUp && !middleUp && ringUp && !pinkyUp) {
                return "Feel hungry";
            }
            if (thumbUp && !indexUp && !middleUp && !ringUp && pinkyUp) {
                return "Need food";
            }
            if (!thumbUp && !indexUp && middleUp && ringUp && !pinkyUp) {
                return "Feel thirsty";
            }
            if (thumbUp && indexUp && !middleUp && ringUp && pinkyUp) {
                return "Need doctor";
            }
            if (!thumbUp && indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Call family";
            }
            if (thumbUp && !indexUp && middleUp && ringUp && pinkyUp) {
                return "Feel better";
            }
            if (!thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Thank you doctor";
            }
            if (thumbUp && !indexUp && !middleUp && ringUp && !pinkyUp) {
                return "Need wheelchair";
            }
            if (!thumbUp && indexUp && !middleUp && !ringUp && pinkyUp) {
                return "Feel tired";
            }
            if (thumbUp && indexUp && middleUp && ringUp && !pinkyUp) {
                return "Call nurse";
            }
            if (!thumbUp && !indexUp && middleUp && ringUp && pinkyUp) {
                return "Need bathroom";
            }
            if (thumbUp && indexUp && !middleUp && ringUp && !pinkyUp) {
                return "Feel dizzy";
            }
            if (!thumbUp && indexUp && middleUp && !ringUp && pinkyUp) {
                return "Need medicine now";
            }
            if (thumbUp && !indexUp && middleUp && ringUp && !pinkyUp) {
                return "Feeling better";
            }
            if (!thumbUp && indexUp && !middleUp && ringUp && pinkyUp) {
                return "Need assistance";
            }
            if (thumbUp && !indexUp && middleUp && !ringUp && pinkyUp) {
                return "Emergency help";
            }
            if (!thumbUp && indexUp && middleUp && ringUp && pinkyUp) {
                return "Call immediately";
            }

            // Add these new conditions
            if (thumbUp && indexUp && !middleUp && ringUp && pinkyUp) {
                return "Need oxygen";
            }
            if (!thumbUp && !indexUp && middleUp && ringUp && !pinkyUp) {
                return "Cant breathe";
            }
            if (thumbUp && indexUp && middleUp && !ringUp && pinkyUp) {
                return "Feel weak";
            }
            if (!thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Blood pressure";
            }
            if (thumbUp && !indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Heart pain";
            }
            if (!thumbUp && !indexUp && !middleUp && ringUp && !pinkyUp) {
                return "Sugar low";
            }
            if (thumbUp && !indexUp && !middleUp && ringUp && pinkyUp) {
                return "Headache";
            }
            if (!thumbUp && !indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Stomach pain";
            }
            if (thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Feel nauseous";
            }
            if (!thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Need injection";
            }

            // Alphabet Signs
            if (thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp && 
                Math.abs(landmarks[8].x - landmarks[4].x) < 0.1) {
                return "Letter A";
            }

            if (thumbUp && indexUp && middleUp && ringUp && pinkyUp &&
                landmarks[8].y < landmarks[7].y) {
                return "Letter B";
            }

            if (thumbUp && landmarks[4].x > landmarks[8].x &&
                !indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Letter C";
            }

            if (thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp &&
                landmarks[8].y < landmarks[4].y) {
                return "Letter D";
            }

            if (thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp &&
                landmarks[4].x < landmarks[8].x) {
                return "Letter E";
            }

            if (thumbUp && indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Letter F";
            }

            if (!thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp &&
                landmarks[8].x > landmarks[5].x) {
                return "Letter G";
            }

            if (!thumbUp && indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Letter H";
            }

            if (!thumbUp && !indexUp && !middleUp && !ringUp && pinkyUp) {
                return "Letter I";
            }

            if (!thumbUp && !indexUp && !middleUp && !ringUp && pinkyUp &&
                landmarks[20].x > landmarks[17].x) {
                return "Letter J";
            }

            if (thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp &&
                landmarks[8].x > landmarks[4].x) {
                return "Letter K";
            }

            if (thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp &&
                landmarks[4].y < landmarks[8].y) {
                return "Letter L";
            }

            if (thumbUp && !indexUp && middleUp && !ringUp && !pinkyUp &&
                landmarks[12].x > landmarks[4].x) {
                return "Letter M";
            }

            if (thumbUp && indexUp && middleUp && !ringUp && !pinkyUp &&
                landmarks[8].x > landmarks[12].x) {
                return "Letter N";
            }

            if (thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp &&
                landmarks[4].y > landmarks[8].y) {
                return "Letter O";
            }

            if (thumbUp && indexUp && middleUp && !ringUp && !pinkyUp &&
                landmarks[8].x < landmarks[12].x) {
                return "Letter P";
            }

            if (thumbUp && indexUp && !middleUp && !ringUp && pinkyUp) {
                return "Letter Q";
            }

            if (!thumbUp && indexUp && middleUp && !ringUp && !pinkyUp &&
                landmarks[8].x < landmarks[12].x) {
                return "Letter R";
            }

            if (!thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Letter S";
            }

            if (!thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp &&
                landmarks[8].y > landmarks[5].y) {
                return "Letter T";
            }

            if (!thumbUp && indexUp && middleUp && !ringUp && !pinkyUp &&
                landmarks[12].y < landmarks[11].y) {
                return "Letter U";
            }

            if (!thumbUp && indexUp && middleUp && !ringUp && !pinkyUp &&
                landmarks[12].y > landmarks[11].y) {
                return "Letter V";
            }

            if (!thumbUp && indexUp && middleUp && ringUp && !pinkyUp) {
                return "Letter W";
            }

            if (thumbUp && !indexUp && !middleUp && !ringUp && pinkyUp &&
                landmarks[4].x < landmarks[20].x) {
                return "Letter X";
            }

            if (thumbUp && !indexUp && !middleUp && !ringUp && pinkyUp &&
                landmarks[4].y < landmarks[20].y) {
                return "Letter Y";
            }

            if (!thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp &&
                landmarks[8].x < landmarks[5].x) {
                return "Letter Z";
            }

            // Numbers 1-10
            if (!thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Number 1";
            }
            if (!thumbUp && indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Number 2";
            }
            if (!thumbUp && indexUp && middleUp && ringUp && !pinkyUp) {
                return "Number 3";
            }
            if (!thumbUp && indexUp && middleUp && ringUp && pinkyUp) {
                return "Number 4";
            }
            if (thumbUp && indexUp && middleUp && ringUp && pinkyUp) {
                return "Number 5";
            }
            if (thumbUp && !indexUp && middleUp && ringUp && pinkyUp) {
                return "Number 6";
            }
            if (thumbUp && indexUp && !middleUp && ringUp && pinkyUp) {
                return "Number 7";
            }
            if (thumbUp && indexUp && middleUp && !ringUp && pinkyUp) {
                return "Number 8";
            }
            if (thumbUp && indexUp && middleUp && ringUp && !pinkyUp) {
                return "Number 9";
            }
            if (!thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Number 10";
            }

            // Numbers 11-20
            if (thumbUp && !indexUp && !middleUp && !ringUp && pinkyUp) {
                return "Number 11";
            }
            if (thumbUp && indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Number 12";
            }
            if (thumbUp && indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Number 13";
            }
            if (thumbUp && !indexUp && middleUp && !ringUp && pinkyUp) {
                return "Number 14";
            }
            if (!thumbUp && indexUp && !middleUp && ringUp && pinkyUp) {
                return "Number 15";
            }
            if (!thumbUp && !indexUp && middleUp && ringUp && pinkyUp) {
                return "Number 16";
            }
            if (!thumbUp && indexUp && middleUp && !ringUp && pinkyUp) {
                return "Number 17";
            }
            if (thumbUp && !indexUp && !middleUp && ringUp && pinkyUp) {
                return "Number 18";
            }
            if (thumbUp && !indexUp && middleUp && !ringUp && pinkyUp) {
                return "Number 19";
            }
            if (thumbUp && indexUp && !middleUp && ringUp && !pinkyUp) {
                return "Number 20";
            }

            // Numbers 21-30
            if (!thumbUp && indexUp && middleUp && ringUp && !pinkyUp) {
                return "Number 21";
            }
            if (thumbUp && !indexUp && middleUp && ringUp && !pinkyUp) {
                return "Number 22";
            }
            if (thumbUp && indexUp && !middleUp && !ringUp && pinkyUp) {
                return "Number 23";
            }
            if (!thumbUp && !indexUp && middleUp && !ringUp && pinkyUp) {
                return "Number 24";
            }
            if (thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "Number 25";
            }
            if (!thumbUp && indexUp && !middleUp && !ringUp && pinkyUp) {
                return "Number 26";
            }
            if (!thumbUp && !indexUp && middleUp && ringUp && !pinkyUp) {
                return "Number 27";
            }
            if (thumbUp && indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Number 28";
            }
            if (!thumbUp && !indexUp && !middleUp && ringUp && pinkyUp) {
                return "Number 29";
            }
            if (thumbUp && !indexUp && middleUp && !ringUp && !pinkyUp) {
                return "Number 30";
            }

            return null;
        }

        function handleNewCandidate(candidate) {
            if (!candidate) {
                predCount = 0;
                lastPred = null;
                return;
            }
            
            if (candidate === lastPred) {
                predCount++;
                console.log("Prediction count:", predCount, "for gesture:", candidate); // Debug log
            } else {
                lastPred = candidate;
                predCount = 1;
            }
            
            if (predCount >= REQUIRED_CONSISTENCY && candidate !== currentLabel) {
                currentLabel = candidate;
                console.log("New gesture detected:", currentLabel); // Debug log
                updateUIAndSpeak(candidate);
            }
        }

        function updateUIAndSpeak(label) {
            if (detectedTextEl) {
                detectedTextEl.innerHTML = `<i class="fas fa-eye"></i> Detected Text: <strong>${label}</strong>`;
            }
            if (autoSpeakCheckbox && autoSpeakCheckbox.checked) {
                speak(label);
            }
        }

        function setupHands() {
            try {
                hands = new Hands({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${file}`;
                    }
                });
                
                hands.setOptions({
                    selfieMode: true,
                    maxNumHands: 1,
                    modelComplexity: 0,  // Changed to 0 for better performance
                    minDetectionConfidence: 0.8,  // Lowered for better detection
                    minTrackingConfidence: 0.8    // Lowered for better detection
                });
                
                hands.onResults(onHandsResults);
                console.log("Hands setup successful");
            } catch (error) {
                console.error("Error setting up hands:", error);
                showNotification("Error setting up hand detection", 'error');
            }
        }

        // Update the onHandsResults function
        function onHandsResults(results) {
            if (!canvasCtx || !canvasElem) return;
            
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElem.width, canvasElem.height);
            
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                for (const landmarks of results.multiHandLandmarks) {
                    // Draw hand landmarks
                    drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, 
                        {color: '#00FFF2', lineWidth: 3});
                    drawLandmarks(canvasCtx, landmarks, 
                        {color: '#FFFFFF', lineWidth: 1, radius: 3});
                    
                    // Process gesture recognition with debug logging
                    const gesture = recognizeFromLandmarks(landmarks);
                    if (gesture) {
                        console.log("Detected gesture:", gesture);  // Debug log
                        handleNewCandidate(gesture);
                    }
                }
            } else {
                handleNewCandidate(null);
            }
            
            canvasCtx.restore();
        }

        async function startCameraAndDetection() {
            if (running) return;
            
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const cameras = devices.filter(device => device.kind === 'videoinput');
                
                if (cameras.length === 0) {
                    throw new Error('No camera found on this device');
                }

                setupHands();

                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: 640,
                        height: 480,
                        facingMode: 'user'
                    }
                });
                
                if (!videoElem) {
                    throw new Error('Video element not found');
                }

                videoElem.srcObject = stream;
                await videoElem.play();

                camera = new Camera(videoElem, {
                    onFrame: async () => {
                        if (hands) {
                            await hands.send({image: videoElem});
                        }
                    },
                    width: 640,
                    height: 480
                });

                await camera.start();
                running = true;
                
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                if (startBtn) startBtn.disabled = true;
                if (stopBtn) stopBtn.disabled = false;
                
                showNotification("Camera started successfully!", 'success');

            } catch (err) {
                console.error('Camera Error:', err);
                showNotification("Camera Error: " + err.message, 'error');
                stopCameraAndDetection();
            }
        }

        function stopCameraAndDetection() {
            if (!running) return;
            
            try {
                if (videoElem && videoElem.srcObject) {
                    const tracks = videoElem.srcObject.getTracks();
                    tracks.forEach(track => track.stop());
                    videoElem.srcObject = null;
                }

                if (camera) {
                    camera.stop();
                    camera = null;
                }
                
                if (hands) {
                    hands.close();
                    hands = null;
                }
                
                running = false;
                
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                if (startBtn) startBtn.disabled = false;
                if (stopBtn) stopBtn.disabled = true;
                
                currentLabel = "None";
                if (detectedTextEl) {
                    detectedTextEl.innerHTML = `<i class="fas fa-eye"></i> Detected Text: <strong>None</strong>`;
                }
                window.speechSynthesis.cancel();
                
                showNotification("Detection stopped", 'info');
            } catch (err) {
                console.error('Error stopping camera:', err);
                showNotification("Error stopping camera: " + err.message, 'error');
            }
        }

        function speak(text) {
            if (!("speechSynthesis" in window)) {
                showNotification("Text to speech not supported in this browser.", 'error');
                return;
            }
            
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = "en-US";
            utterance.rate = 1;
            utterance.pitch = 1;
            window.speechSynthesis.speak(utterance);
        }
        
        // Modal elements
        const modal = document.getElementById('detectionInfoModal');
        const infoBtn = document.getElementById('infoBtn');
        const closeBtn = document.querySelector('.close-btn');
        const gestureListEl = document.getElementById('gestureList');

        const gestures = [
            { sign: "Thank you", description: "All five fingers extended." },
            { sign: "I love you", description: "Thumb, index, and pinky extended; middle and ring curled." },
            { sign: "Hello", description: "Index, middle, ring, and pinky extended; thumb curled." },
            { sign: "Goodbye", description: "Only pinky extended." },
            { sign: "Yes", description: "Only thumb extended." },
            { sign: "No", description: "Index and middle fingers extended." },
            { sign: "Help needed", description: "Thumb and middle finger extended only" },
            { sign: "Food please", description: "Index and ring fingers extended only" },
            { sign: "Water please", description: "Thumb and ring fingers extended only" },
            { sign: "Emergency", description: "Index, middle, and pinky extended" },
            { sign: "Medicine", description: "Thumb, index, and ring extended" },
            { sign: "Hospital", description: "Middle, ring, and pinky extended" },
            { sign: "Phone", description: "Thumb, middle, and ring extended" },
            { sign: "Restroom", description: "Index and pinky extended only" },
            // Add these new gestures
            { sign: "Please wait", description: "Thumb, middle, and pinky extended" },
            { sign: "Need water", description: "Index, middle, and ring fingers extended" },
            { sign: "Feel sick", description: "Thumb, index, and middle extended" },
            { sign: "Need rest", description: "Middle and pinky fingers extended" },
            { sign: "Call doctor", description: "Thumb, ring, and pinky extended" },
            { sign: "Feel pain", description: "Index, ring, and pinky extended" },
            { sign: "Need medicine", description: "Thumb, index, and pinky extended" },
            { sign: "Call ambulance", description: "Index, middle, and pinky extended" },
            { sign: "Feel dizzy", description: "Thumb, middle, and pinky extended" },
            { sign: "Need help", description: "Ring and pinky fingers extended" },
            // Add these new gesture combinations
            { sign: "Feeling cold", description: "Thumb, index, middle and pinky extended" },
            { sign: "Feeling hot", description: "Index, middle and ring fingers extended" },
            { sign: "Need blanket", description: "Thumb, middle, and pinky extended" },
            { sign: "Feel hungry", description: "Index and ring fingers extended" },
            { sign: "Need food", description: "Thumb and pinky extended only" },
            { sign: "Feel thirsty", description: "Middle and ring fingers extended" },
            { sign: "Need doctor", description: "Thumb, index, ring and pinky extended" },
            { sign: "Call family", description: "Index and middle extended only" },
            { sign: "Feel better", description: "Thumb, middle, ring and pinky extended" },
            { sign: "Thank you doctor", description: "Only index finger extended" },
            { sign: "Need wheelchair", description: "Thumb and ring finger extended only" },
            { sign: "Feel tired", description: "Index and pinky fingers extended only" },
            { sign: "Call nurse", description: "All fingers except pinky extended" },
            { sign: "Need bathroom", description: "Middle, ring, and pinky extended" },
            { sign: "Feel dizzy", description: "Thumb, index, and ring extended" },
            { sign: "Need medicine now", description: "Index, middle, and pinky extended" },
            { sign: "Feeling better", description: "Thumb, middle, and ring extended" },
            { sign: "Need assistance", description: "Thumb and index extended only" },
            { sign: "Feel uncomfortable", description: "Only middle finger extended" },
            { sign: "Need bed rest", description: "Thumb and middle extended" },
            { sign: "Call reception", description: "Only index extended" },
            { sign: "Feel anxious", description: "Thumb, index, and middle fingers extended" },
            { sign: "High fever", description: "Index and ring fingers extended" },
            { sign: "Low fever", description: "Thumb and middle fingers extended" },
            { sign: "Need washroom", description: "Only middle finger extended" },
            { sign: "Body ache", description: "Thumb, index, and pinky extended" },
            { sign: "Joint swelling", description: "Only ring finger extended" },
            { sign: "Need bed", description: "Thumb, middle, and ring extended" },
            { sign: "Feel vomiting", description: "Index, middle, and pinky extended" },
            { sign: "Need stretcher", description: "Thumb, ring, and pinky extended" },
            { sign: "Need nurse", description: "Index and pinky extended" }
        ];

        const alphabetGestures = [
            { sign: "Letter A", description: "Fist with thumb on side" },
            { sign: "Letter B", description: "Flat hand with fingers together" },
            { sign: "Letter C", description: "Curved hand shape" },
            { sign: "Letter D", description: "Index finger pointing up, thumb on side" },
            { sign: "Letter E", description: "Curved fingers, thumb across palm" },
            { sign: "Letter F", description: "Index and thumb touching" },
            { sign: "Letter G", description: "Index finger pointing sideways" },
            { sign: "Letter H", description: "Two fingers pointing sideways" },
            { sign: "Letter I", description: "Pinky finger only" },
            { sign: "Letter J", description: "Pinky moving in J shape" },
            { sign: "Letter K", description: "Index and middle finger in V shape" },
            { sign: "Letter L", description: "L shape with thumb and index" },
            { sign: "Letter M", description: "Three fingers pointing down" },
            { sign: "Letter N", description: "Two fingers pointing down" },
            { sign: "Letter O", description: "Fingers curved into O shape" },
            { sign: "Letter P", description: "Index pointing down" },
            { sign: "Letter Q", description: "Index pointing down with thumb" },
            { sign: "Letter R", description: "Crossed fingers" },
            { sign: "Letter S", description: "Fist with thumb across fingers" },
            { sign: "Letter T", description: "Index finger pointing up" },
            { sign: "Letter U", description: "Two fingers pointing up together" },
            { sign: "Letter V", description: "Two fingers in V shape" },
            { sign: "Letter W", description: "Three fingers in W shape" },
            { sign: "Letter X", description: "Bent index finger" },
            { sign: "Letter Y", description: "Thumb and pinky extended" },
            { sign: "Letter Z", description: "Index finger drawing Z shape" }
        ];

        const numberGestures = [
            { sign: "Number 1", description: "Index finger only" },
            { sign: "Number 2", description: "Index and middle fingers" },
            { sign: "Number 3", description: "Index, middle, and ring fingers" },
            { sign: "Number 4", description: "All fingers except thumb" },
            { sign: "Number 5", description: "All fingers extended" },
            { sign: "Number 6", description: "All fingers except index" },
            { sign: "Number 7", description: "All fingers except middle" },
            { sign: "Number 8", description: "All fingers except ring" },
            { sign: "Number 9", description: "All fingers except pinky" },
            { sign: "Number 10", description: "Closed fist" },
            { sign: "Number 11", description: "Thumb and pinky only" },
            { sign: "Number 12", description: "Thumb and index only" },
            { sign: "Number 13", description: "Thumb, index, and middle" },
            { sign: "Number 14", description: "Thumb, middle, and pinky" },
            { sign: "Number 15", description: "Index, ring, and pinky" },
            { sign: "Number 16", description: "Middle, ring, and pinky" },
            { sign: "Number 17", description: "Index, middle, and pinky" },
            { sign: "Number 18", description: "Thumb, ring, and pinky" },
            { sign: "Number 19", description: "Thumb, middle, and pinky" },
            { sign: "Number 20", description: "Thumb, index, and ring" },
            { sign: "Number 21", description: "Index, middle, and ring" },
            { sign: "Number 22", description: "Thumb, middle, and ring" },
            { sign: "Number 23", description: "Thumb, index, and pinky" },
            { sign: "Number 24", description: "Middle and pinky only" },
            { sign: "Number 25", description: "Thumb only" },
            { sign: "Number 26", description: "Index and pinky only" },
            { sign: "Number 27", description: "Middle and ring only" },
            { sign: "Number 28", description: "Thumb, index, and middle" },
            { sign: "Number 29", description: "Ring and pinky only" },
            { sign: "Number 30", description: "Thumb and middle only" }
        ];

        gestures.push(...alphabetGestures, ...numberGestures);  // Add alphabet and number gestures to main gestures array

        // Update the updateGestureList function
        function updateGestureList() {
            if (!gestureListEl) return;
            
            gestureListEl.innerHTML = `
                <h4 style="color: #00fff2; margin-bottom: 1rem;">Basic Signs</h4>
                ${gestures.slice(0, 6).map(g => `<li><strong>${g.sign}:</strong> ${g.description}</li>`).join('')}
                
                <h4 style="color: #00fff2; margin: 1rem 0;">Medical & Emergency Signs</h4>
                ${gestures.slice(6, 50).map(g => `<li><strong>${g.sign}:</strong> ${g.description}</li>`).join('')}
                
                <h4 style="color: #00fff2; margin: 1rem 0;">Alphabet Signs (A-Z)</h4>
                ${alphabetGestures.map(g => `<li><strong>${g.sign}:</strong> ${g.description}</li>`).join('')}
                
                <h4 style="color: #00fff2; margin: 1rem 0;">Number Signs (1-30)</h4>
                ${numberGestures.map(g => `<li><strong>${g.sign}:</strong> ${g.description}</li>`).join('')}
            `;
        }

        // Replace the existing startCameraAndDetection function with this updated version
        async function startCameraAndDetection() {
            if (running) return;
            
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const cameras = devices.filter(device => device.kind === 'videoinput');
                
                if (cameras.length === 0) {
                    throw new Error('No camera found on this device');
                }

                setupHands();

                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: 640,
                        height: 480,
                        facingMode: 'user'
                    }
                });
                
                if (!videoElem) {
                    throw new Error('Video element not found');
                }

                videoElem.srcObject = stream;
                await videoElem.play();

                camera = new Camera(videoElem, {
                    onFrame: async () => {
                        if (hands) {
                            await hands.send({image: videoElem});
                        }
                    },
                    width: 640,
                    height: 480
                });

                await camera.start();
                running = true;
                
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                if (startBtn) startBtn.disabled = true;
                if (stopBtn) stopBtn.disabled = false;
                
                showNotification("Camera started successfully!", 'success');

            } catch (err) {
                console.error('Camera Error:', err);
                showNotification("Camera Error: " + err.message, 'error');
                stopCameraAndDetection();
            }
        }

        // Update the event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const speakBtn = document.getElementById('speakBtn');
            const infoBtn = document.getElementById('infoBtn');
            const modal = document.getElementById('detectionInfoModal');
            const closeBtn = document.querySelector('.close-btn');

            // Start button
            if (startBtn) {
                startBtn.addEventListener('click', async () => {
                    try {
                        await startCameraAndDetection();
                    } catch (error) {
                        console.error('Start error:', error);
                        showNotification('Failed to start camera', 'error');
                    }
                });
            }

            // Stop button
            if (stopBtn) {
                stopBtn.addEventListener('click', () => {
                    stopCameraAndDetection();
                });
            }

            // Speak button
            if (speakBtn) {
                speakBtn.addEventListener('click', () => {
                    if (currentLabel && currentLabel !== "None") {
                        speak(currentLabel);
                    }
                });
            }

            // Info button
            if (infoBtn) {
                infoBtn.addEventListener('click', () => {
                    updateGestureList();
                    if (modal) {
                        modal.style.display = "block";
                    }
                });
            }

            // Close button for modal
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    if (modal) {
                        modal.style.display = "none";
                    }
                });
            }

            // Click outside modal to close
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            });
        });

        // Update the stopCameraAndDetection function
        function stopCameraAndDetection() {
            if (!running) return;
            
            try {
                if (videoElem && videoElem.srcObject) {
                    const tracks = videoElem.srcObject.getTracks();
                    tracks.forEach(track => track.stop());
                    videoElem.srcObject = null;
                }

                if (camera) {
                    camera.stop();
                    camera = null;
                }
                
                if (hands) {
                    hands.close();
                    hands = null;
                }
                
                running = false;
                
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                if (startBtn) startBtn.disabled = false;
                if (stopBtn) stopBtn.disabled = true;
                
                currentLabel = "None";
                if (detectedTextEl) {
                    detectedTextEl.innerHTML = `<i class="fas fa-eye"></i> Detected Text: <strong>None</strong>`;
                }
                window.speechSynthesis.cancel();
                
                showNotification("Detection stopped", 'info');
            } catch (err) {
                console.error('Error stopping camera:', err);
                showNotification("Error stopping camera: " + err.message, 'error');
            }
        }
    </script>
</body>
</html>
